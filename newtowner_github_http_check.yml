name: Newtowner GitHub HTTP Check # Updated name
run-name: Newtowner Check ${{ github.event.inputs.run_id_tag }} # Ensures run_id_tag is in the run's display name
on:
  workflow_dispatch:
    inputs:
      target_url:
        description: 'Comma-separated string of URLs to check from the GitHub Action runner'
        required: true
        type: string
      run_id_tag: # This tag helps create a unique artifact name
        description: 'A unique tag to help identify artifacts for this specific trigger'
        required: true
        type: string

jobs:
  check_url_from_runner:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4 # To access the python script

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests
          pip install cryptography
          # If you had a requirements.txt in the scripts/ directory:
          # pip install -r scripts/requirements.txt 

      - name: Run HTTP Check Runner Script
        id: run_script
        run: |
          python scripts/http_check_runner.py "${{ github.event.inputs.target_url }}" --output_file result.json
        shell: bash

      - name: Upload Check Result Artifact
        uses: actions/upload-artifact@v4
        with:
          name: newtowner-check-result-${{ github.event.inputs.run_id_tag }} # Use the input tag for unique artifact name
          path: result.json # Upload the JSON file generated by the script
          retention-days: 1 
